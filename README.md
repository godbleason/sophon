# Sophon

è½»é‡çº§ä¸ªäºº AI åŠ©æ‰‹æ¡†æ¶ã€‚æ”¯æŒå¤šé€šé“äº¤äº’ã€å·¥å…·è°ƒç”¨ã€å®šæ—¶ä»»åŠ¡ã€å­ä»£ç†åå°æ‰§è¡Œå’Œé•¿æœŸè®°å¿†ã€‚

## ç‰¹æ€§

- **å¤šé€šé“æ¥å…¥** â€” CLI å‘½ä»¤è¡Œ + Web èŠå¤©ç•Œé¢ï¼ˆWebSocket å®æ—¶é€šä¿¡ï¼‰ï¼Œå¯æ‰©å±• Telegram / Discord
- **Agent Loop** â€” å®Œæ•´çš„ LLM å·¥å…·è°ƒç”¨å¾ªç¯ï¼Œæ”¯æŒå¤šè½®è¿­ä»£ã€è¿›åº¦æ¨é€å’Œä¼šè¯å–æ¶ˆ
- **å†…ç½®å·¥å…·é›†** â€” æ–‡ä»¶è¯»å†™ã€Shell å‘½ä»¤ã€æ—¥æœŸæ—¶é—´ã€å®šæ—¶ä»»åŠ¡ã€å­ä»£ç†
- **å­ä»£ç†ç³»ç»Ÿ** â€” å°†è€—æ—¶ä»»åŠ¡å§”æ‰˜ç»™åå°å­ä»£ç†å¼‚æ­¥æ‰§è¡Œï¼Œå®Œæˆåè‡ªåŠ¨é€šçŸ¥
- **å®šæ—¶ä»»åŠ¡** â€” åŸºäº Cron è¡¨è¾¾å¼çš„ä»»åŠ¡è°ƒåº¦ï¼Œæ”¯æŒæŒä¹…åŒ–å’Œè‡ªåŠ¨æ¢å¤
- **è®°å¿†ç³»ç»Ÿ** â€” é•¿æœŸäº‹å®è®°å¿† (MEMORY.md) + å†å²æ—¥å¿— (HISTORY.md)ï¼Œè·¨ä¼šè¯ä¿ç•™ä¸Šä¸‹æ–‡
- **æŠ€èƒ½ç³»ç»Ÿ** â€” é€šè¿‡ Markdown æ–‡ä»¶å®šä¹‰å¯æ’æ‹”çš„æŠ€èƒ½æç¤ºè¯
- **å¤š LLM æ”¯æŒ** â€” OpenAI / DeepSeek / OpenRouterï¼Œç»Ÿä¸€æ¥å£å¯æ‰©å±•
- **ä¼šè¯æŒä¹…åŒ–** â€” JSONL æ ¼å¼è‡ªåŠ¨ä¿å­˜å¯¹è¯å†å²ï¼Œé‡å¯åè‡ªåŠ¨æ¢å¤
- **ç»“æ„åŒ–æ—¥å¿—** â€” åŸºäº pino çš„ JSON æ ¼å¼æ—¥å¿—ï¼Œæ”¯æŒå¤šçº§åˆ«
- **é…ç½®çµæ´»** â€” JSON é…ç½® + `.env` ç¯å¢ƒå˜é‡ + CLI å‚æ•°ï¼Œä¸‰å±‚è¦†ç›–

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0

### å®‰è£…

```bash
git clone <repo-url> sophon
cd sophon
npm install
```

### é…ç½®

1. åˆ›å»º `.env` æ–‡ä»¶ï¼Œè®¾ç½® API Keyï¼š

```bash
# è‡³å°‘é…ç½®ä¸€ä¸ª LLM æä¾›å•†
DEEPSEEK_API_KEY=your-api-key-here

# å¯é€‰
OPENAI_API_KEY=your-openai-key
OPENROUTER_API_KEY=your-openrouter-key
```

2. é»˜è®¤é…ç½®æ–‡ä»¶ä½äº `config/default.json`ï¼Œå¯æŒ‰éœ€ä¿®æ”¹ï¼Œä¹Ÿå¯åˆ›å»º `config/config.json` è¿›è¡Œè¦†ç›–ã€‚

### å¯åŠ¨

```bash
# å¼€å‘æ¨¡å¼
npm run dev

# æˆ–æ„å»ºåè¿è¡Œ
npm run build
npm start
```

å¯åŠ¨åå°†åŒæ—¶æä¾›ï¼š
- **CLI äº¤äº’** â€” ç»ˆç«¯å†…ç›´æ¥è¾“å…¥å¯¹è¯
- **Web ç•Œé¢** â€” æµè§ˆå™¨è®¿é—® `http://localhost:3000`

### CLI é€‰é¡¹

```bash
# æŒ‡å®šé…ç½®æ–‡ä»¶
npm run dev -- -c path/to/config.json

# æŒ‡å®šæ¨¡å‹
npm run dev -- -m gpt-4o

# è¯¦ç»†æ—¥å¿—
npm run dev -- -v
```

## é¡¹ç›®ç»“æ„

```
sophon/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ default.json          # é»˜è®¤é…ç½®
â”œâ”€â”€ skills/
â”‚   â””â”€â”€ coding-assistant.md   # æŠ€èƒ½å®šä¹‰ï¼ˆMarkdownï¼‰
â”œâ”€â”€ data/                     # è¿è¡Œæ—¶æ•°æ®ï¼ˆgit ignoredï¼‰
â”‚   â”œâ”€â”€ sessions/             # ä¼šè¯æ•°æ®ï¼ˆå†å² + å·¥ä½œåŒº + å®šæ—¶ä»»åŠ¡ï¼‰
â”‚   â””â”€â”€ memory/               # é•¿æœŸè®°å¿†
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # å…¥å£ï¼ŒCLI å‚æ•°è§£æ
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config-manager.ts # é…ç½®åŠ è½½ä¸éªŒè¯
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ app.ts            # åº”ç”¨ç»„è£…ä¸å¯åŠ¨
â”‚   â”‚   â”œâ”€â”€ agent-loop.ts     # Agent å¾ªç¯ï¼ˆLLM â†” å·¥å…·ï¼‰
â”‚   â”‚   â”œâ”€â”€ message-bus.ts    # æ¶ˆæ¯æ€»çº¿ï¼ˆå…¥ç«™ / å‡ºç«™ / è¿›åº¦ï¼‰
â”‚   â”‚   â”œâ”€â”€ session-manager.ts# ä¼šè¯ç®¡ç†ä¸æŒä¹…åŒ–
â”‚   â”‚   â”œâ”€â”€ tool-registry.ts  # å·¥å…·æ³¨å†Œè¡¨
â”‚   â”‚   â”œâ”€â”€ scheduler.ts      # å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â”‚   â”œâ”€â”€ subagent-manager.ts # å­ä»£ç†ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ async-queue.ts    # å¼‚æ­¥é˜Ÿåˆ—
â”‚   â”‚   â”œâ”€â”€ errors.ts         # é”™è¯¯ç±»å‹
â”‚   â”‚   â””â”€â”€ logger.ts         # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ channels/
â”‚   â”‚   â”œâ”€â”€ base-channel.ts   # é€šé“æ¥å£
â”‚   â”‚   â”œâ”€â”€ cli-channel.ts    # CLI é€šé“
â”‚   â”‚   â”œâ”€â”€ web-channel.ts    # Web é€šé“ï¼ˆHTTP + WebSocketï¼‰
â”‚   â”‚   â””â”€â”€ web-chat-ui.ts    # Web èŠå¤© UI
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ openai-compatible-base.ts # OpenAI å…¼å®¹åŸºç±»
â”‚   â”‚   â”œâ”€â”€ openai-provider.ts
â”‚   â”‚   â”œâ”€â”€ deepseek-provider.ts
â”‚   â”‚   â”œâ”€â”€ openrouter-provider.ts
â”‚   â”‚   â””â”€â”€ provider-factory.ts
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”œâ”€â”€ index.ts          # å·¥å…·é›†åˆæ³¨å†Œ
â”‚   â”‚   â”œâ”€â”€ file-tools.ts     # æ–‡ä»¶è¯»å†™å·¥å…·
â”‚   â”‚   â”œâ”€â”€ shell-tool.ts     # Shell å‘½ä»¤å·¥å…·
â”‚   â”‚   â”œâ”€â”€ datetime-tool.ts  # æ—¥æœŸæ—¶é—´å·¥å…·
â”‚   â”‚   â”œâ”€â”€ schedule-tool.ts  # å®šæ—¶ä»»åŠ¡å·¥å…·
â”‚   â”‚   â””â”€â”€ spawn-tool.ts     # å­ä»£ç†å·¥å…·
â”‚   â”œâ”€â”€ memory/
â”‚   â”‚   â””â”€â”€ memory-store.ts   # è®°å¿†å­˜å‚¨
â”‚   â”œâ”€â”€ skills/
â”‚   â”‚   â””â”€â”€ skills-loader.ts  # æŠ€èƒ½åŠ è½½å™¨
â”‚   â””â”€â”€ types/                # TypeScript ç±»å‹å®šä¹‰
â””â”€â”€ package.json
```

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLI Channel â”‚     â”‚  Web Channel â”‚     ...æ›´å¤šé€šé“
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚
       â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Message Bus               â”‚  å…¥ç«™ / å‡ºç«™ / è¿›åº¦
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Agent Loop                â”‚  LLM è°ƒç”¨ â†” å·¥å…·æ‰§è¡Œå¾ªç¯
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LLM Providerâ”‚ â”‚ Tool Registry â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sessions â”‚ â”‚  Memory  â”‚ â”‚   Subagent   â”‚
â”‚ Manager  â”‚ â”‚  Store   â”‚ â”‚   Manager    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å†…ç½®å·¥å…·

| å·¥å…· | åç§° | è¯´æ˜ |
|------|------|------|
| ğŸ“ | `read_file` | è¯»å–æ–‡ä»¶å†…å®¹ |
| âœï¸ | `write_file` | å†™å…¥æ–‡ä»¶ |
| ğŸ“‚ | `list_dir` | åˆ—å‡ºç›®å½•å†…å®¹ |
| ğŸ–¥ï¸ | `run_shell` | åœ¨å·¥ä½œåŒºæ‰§è¡Œ Shell å‘½ä»¤ |
| ğŸ• | `get_datetime` | è·å–å½“å‰æ—¥æœŸæ—¶é—´ |
| â° | `create_schedule` | åˆ›å»ºå®šæ—¶ä»»åŠ¡ |
| ğŸ“‹ | `list_schedules` | åˆ—å‡ºå®šæ—¶ä»»åŠ¡ |
| ğŸ—‘ï¸ | `remove_schedule` | åˆ é™¤å®šæ—¶ä»»åŠ¡ |
| ğŸ”€ | `toggle_schedule` | å¯ç”¨ / ç¦ç”¨å®šæ—¶ä»»åŠ¡ |
| ğŸš€ | `spawn` | ç”Ÿæˆåå°å­ä»£ç† |
| ğŸ“Š | `subagent_status` | æŸ¥è¯¢å­ä»£ç†çŠ¶æ€ |
| âŒ | `cancel_subagent` | å–æ¶ˆå­ä»£ç† |

## å†…ç½®å‘½ä»¤

åœ¨å¯¹è¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
| `/clear` | æ¸…é™¤å½“å‰ä¼šè¯å†å² |
| `/tools` | åˆ—å‡ºå¯ç”¨å·¥å…· |
| `/status` | æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€ |
| `/stop` | åœæ­¢å½“å‰ä»»åŠ¡ |

## é…ç½®è¯´æ˜

`config/default.json` å®Œæ•´é…ç½®é¡¹ï¼š

```jsonc
{
  // LLM æä¾›å•†ï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼ŒAPI Key å»ºè®®æ”¾ .envï¼‰
  "providers": {
    "deepseek": {},
    "openrouter": {},
    "openai": {}
  },

  // ä»£ç†é…ç½®
  "agent": {
    "model": "deepseek-chat",    // ä½¿ç”¨çš„æ¨¡å‹
    "temperature": 0.7,
    "maxTokens": 4096,
    "maxIterations": 50,         // å•æ¬¡å¯¹è¯æœ€å¤§å·¥å…·è°ƒç”¨è½®æ¬¡
    "systemPrompt": "..."
  },

  // ä¼šè¯é…ç½®
  "session": {
    "storageDir": "data/sessions",
    "memoryWindow": 50           // å†å²çª—å£å¤§å°
  },

  // è®°å¿†é…ç½®
  "memory": {
    "storageDir": "data/memory",
    "enabled": true
  },

  // é€šé“é…ç½®
  "channels": {
    "cli": { "enabled": true, "prompt": "you> " },
    "web": { "enabled": true, "port": 3000, "host": "localhost" }
  },

  // å®šæ—¶ä»»åŠ¡
  "scheduler": {
    "enabled": true,
    "maxTasksPerSession": 20
  },

  // å­ä»£ç†
  "subagent": {
    "enabled": true,
    "maxIterations": 15,         // å­ä»£ç†è¿­ä»£é™åˆ¶ï¼ˆæ¯”ä¸»ä»£ç†æ›´ä¸¥æ ¼ï¼‰
    "maxConcurrent": 5,          // æœ€å¤§å¹¶å‘æ•°
    "timeout": 300000,           // è¶…æ—¶ 5 åˆ†é’Ÿ
    "toolBlacklist": ["spawn", "subagent_status", "cancel_subagent"]
  },

  "logLevel": "info"             // trace | debug | info | warn | error | fatal
}
```

### ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ |
|------|------|
| `DEEPSEEK_API_KEY` | DeepSeek API Key |
| `OPENAI_API_KEY` | OpenAI API Key |
| `OPENAI_API_BASE` | OpenAI API åŸºç¡€ URL |
| `OPENROUTER_API_KEY` | OpenRouter API Key |
| `ANTHROPIC_API_KEY` | Anthropic API Key |
| `TELEGRAM_BOT_TOKEN` | Telegram Bot Token |
| `DISCORD_BOT_TOKEN` | Discord Bot Token |
| `SOPHON_MODEL` | è¦†ç›–é»˜è®¤æ¨¡å‹ |
| `SOPHON_TEMPERATURE` | è¦†ç›–æ¸©åº¦å‚æ•° |
| `SOPHON_LOG_LEVEL` | è¦†ç›–æ—¥å¿—çº§åˆ« |

## å¼€å‘

```bash
# ç±»å‹æ£€æŸ¥
npm run lint

# è¿è¡Œæµ‹è¯•
npm test

# ç›‘å¬æ¨¡å¼æµ‹è¯•
npm run test:watch

# æ„å»º
npm run build

# æŸ¥çœ‹å½“å‰é…ç½®
npx tsx src/index.ts config
```

## æŠ€èƒ½ç³»ç»Ÿ

åœ¨ `skills/` ç›®å½•ä¸‹åˆ›å»º Markdown æ–‡ä»¶å³å¯æ·»åŠ æŠ€èƒ½ã€‚æŠ€èƒ½ä¼šè¢«è‡ªåŠ¨æ³¨å…¥åˆ°ç³»ç»Ÿæç¤ºä¸­ã€‚

```markdown
---
name: my-skill
description: æˆ‘çš„è‡ªå®šä¹‰æŠ€èƒ½
always_load: true
---

# æŠ€èƒ½å†…å®¹

è¿™é‡Œå†™æŠ€èƒ½ç›¸å…³çš„æç¤ºè¯æŒ‡å¯¼...
```

## License

MIT
